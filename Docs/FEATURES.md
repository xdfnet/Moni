# 功能特性

本文档详细介绍了 Moni 应用的所有功能特性，包括核心功能和新增功能。

## 核心功能

### 1. AI 服务延迟监控

**功能描述**: 实时监控各种 AI 服务的网络延迟，帮助用户了解服务可用性和网络质量。

**技术实现**:

- 使用 Network.framework 建立 TCP 连接
- 测量从发起连接到建立成功的时间差
- 支持 443 端口 HTTPS 连接测试

**监控服务**:

- **Cursor**: AI 编程工具中转服务 (`api.cursor.sh`)
- **Claude**: Anthropic AI 服务 (`api.anthropic.com`)
- **Gemini**: Google AI 服务 (`generativelanguage.googleapis.com`)
- **DeepSeek**: 国内 AI 服务 (`api.deepseek.com`)
- **Kimi**: 国内 AI 服务 (`api.moonshot.cn`)

**参数配置**:

- 监控间隔: 0.5s - 10s (可配置)
- 连接超时: 3 秒
- 重试次数: 最多 3 次
- 延迟单位: 毫秒 (ms)

**用户价值**:

- 实时了解 AI 服务的网络质量
- 帮助选择最佳的网络环境
- 监控服务可用性变化

### 2. 网络流量监控

**功能描述**: 监控系统级网络流量，提供实时的下载速度数据。

**技术实现**:

- 使用 sysctl 获取网络接口统计信息
- 计算单位时间内的数据变化
- 智能过滤异常数据

**监控指标**:

- 下载速度: MB/s (保留两位小数)
- 网络接口状态检测
- 数据有效性验证

**数据验证**:

- 最大合理速度: 1000 MB/s
- 接口重置阈值: 1GB
- 异常数据过滤和日志记录

**用户价值**:

- 实时监控网络性能
- 检测网络异常情况
- 提供网络质量参考

### 3. 菜单栏集成

**功能描述**: 在 macOS 菜单栏提供简洁的状态显示和功能入口。

**界面特性**:

- 等宽字体显示，避免数值跳动
- 状态图标指示系统健康状态
- 详细的工具提示信息

**菜单结构**:

- **View**: Service / Network 模式切换
- **Service**: 选择要监控的服务
- **Rate**: 设置监控更新频率
- **About**: 版本和构建信息

**状态指示**:

- ✅ 健康状态 (绿色圆圈)
- ⚠️ 错误状态 (黄色三角)
- ❓ 未知状态 (问号圆圈)

## 新增功能

### 4. 包管理器监控

**功能描述**: 扩展监控范围，包含常用的包管理器和开发工具服务。

**新增服务**:

- **Homebrew**: macOS 包管理器 (`github.com`)
- **NPM**: Node.js 包管理器 (`registry.npmjs.org`)
- **PyPI**: Python 包管理器 (`pypi.org`)
- **Maven**: Java 包管理器 (`repo1.maven.org`)
- **Docker**: 容器镜像仓库 (`registry-1.docker.io`)

**服务分类**:

- **AI 服务**: 人工智能和编程工具
- **包管理器**: 开发环境依赖管理
- **容器服务**: 云原生和部署工具

**用户价值**:

- 全面监控开发环境网络质量
- 帮助优化包下载体验
- 识别网络瓶颈和优化点

### 5. 简化状态管理

**功能描述**: 简化连接状态管理，提供清晰的连接成功/失败状态指示。

**状态管理**:

- **连接成功**: 显示延迟数值，绿色勾图标
- **连接失败**: 显示 `---`，警告图标
- **自动恢复**: 系统睡眠/唤醒后自动重建状态栏和恢复监控

**参数配置**:

- 连接超时: 0.5 秒
- 监控间隔: 500ms
- 状态更新: 实时响应连接变化

**错误处理**:

- 连接超时处理
- 连接失败状态
- 简洁的状态指示

**用户价值**:

- 清晰的状态反馈
- 减少复杂错误信息
- 更好的用户体验

### 6. 状态指示系统

**功能描述**: 提供直观的状态反馈，让用户快速了解系统运行状态。

**状态类型**:

- **健康状态**: 监控正常，无错误
- **错误状态**: 监控失败，显示错误信息
- **未知状态**: 状态不明确

**视觉反馈**:

- 状态栏图标变化
- 颜色编码状态
- 工具提示详细信息

**错误信息**:

- 错误类型分类
- 用户友好的描述
- 调试信息记录

**用户价值**:

- 快速识别系统状态
- 及时发现问题
- 清晰的错误反馈

### 7. 配置管理系统

**功能描述**: 提供灵活的配置管理，支持用户偏好设置和配置导入导出。

**配置项**:

- 显示模式选择
- 监控间隔设置
- 服务选择偏好
- 通知设置
- 监控间隔配置

**配置持久化**:

- UserDefaults 本地存储
- JSON 格式导入导出
- 配置热重载支持

**用户价值**:

- 个性化使用体验
- 配置备份和恢复
- 团队配置共享

### 8. 线程安全改进

**功能描述**: 使用现代并发技术确保应用在多线程环境下的稳定性。

**技术实现**:

- **NSLock**: 保护关键资源访问
- **GCD**: 异步任务调度
- **线程安全队列**: 配置操作串行化

**保护范围**:

- 监控状态管理
- 配置读写操作
- 资源清理过程

**用户价值**:

- 提高应用稳定性
- 避免竞态条件
- 更好的性能表现

### 9. 数据验证增强

**功能描述**: 增强数据有效性检查，过滤异常数据，提高监控准确性。

**验证规则**:

- 网络速度合理性检查
- 接口重置检测
- 数据范围验证

**异常处理**:

- 异常数据过滤
- 统计信息重置
- 详细日志记录

**用户价值**:

- 更准确的监控数据
- 减少异常数据干扰
- 提高系统可靠性

### 10. 工具函数库

**功能描述**: 提供丰富的工具函数，支持开发调试和性能优化。

**功能分类**:

- **数值处理**: 安全转换、范围限制
- **集合操作**: 安全访问、类型转换
- **性能测量**: 执行时间分析、性能统计
- **调试工具**: 条件日志、错误格式化

**使用场景**:

- 开发调试
- 性能优化
- 错误处理
- 数据处理

**用户价值**:

- 提高开发效率
- 代码质量保证
- 性能问题诊断

### 11. 菜单优化

**功能描述**: 优化菜单结构，提供更专业和直观的用户界面。

**改进内容**:

- **View 菜单**: "LLM" → "Service"，"Net" → "Network"
- **服务分类**: 按功能组织监控服务
- **菜单结构**: 清晰的层次和分组

**设计原则**:

- 专业术语使用
- 逻辑分组清晰
- 操作流程直观

**用户价值**:

- 更专业的界面
- 更清晰的功能分类
- 更好的用户体验

### 12. 构建工具重构

**功能描述**: 重构 Makefile，提供模块化构建流程和灵活的构建选项。

**构建流程**:

1. **清理控制台** - 清屏准备
2. **关闭应用** - 检测并关闭运行中的应用
3. **更新版本** - 自动递增版本号和构建号
4. **构建应用** - 使用 Release 配置构建
5. **安装应用** - 安装到 /Applications
6. **清理文件** - 删除构建临时文件
7. **打开应用** - 自动启动新应用

**构建选项**:

- **make**: 执行完整构建流程（推荐）
- **make build**: 完整构建流程（包含版本递增）
- **make build-fixed**: 固定版本构建（不递增版本）

**输出控制**:

- **标准模式**: 显示构建进度
- **静默模式**: 只显示警告和错误
- **详细模式**: 显示所有构建细节
- **完全静默**: 隐藏所有输出

**用户价值**:

- 一键完成复杂构建流程
- 灵活的构建选项
- 可控的输出信息

## 技术特性

### 架构设计

- **分层架构**: 清晰的职责分离和模块化设计
- **设计模式**: 单例、代理、策略、模板方法等模式
- **协议导向**: 基于协议的接口设计

### 性能优化

- **内存管理**: 自动引用计数和资源清理
- **并发处理**: 异步操作和线程安全
- **缓存策略**: 智能缓存和过期处理

### 错误处理

- **统一错误类型**: 标准化的错误分类和处理
- **用户友好提示**: 清晰的错误信息和解决建议
- **错误恢复**: 智能重试和自动恢复机制

### 可扩展性

- **插件架构**: 支持新监控类型的扩展
- **配置驱动**: 通过配置添加新服务
- **模块化设计**: 独立的功能模块

## 用户体验

### 界面设计

- **简洁美观**: 现代化的 macOS 设计风格
- **信息丰富**: 详细的状态信息和工具提示
- **操作便捷**: 一键操作和快捷菜单

### 性能表现

- **响应迅速**: 毫秒级的响应时间
- **资源占用低**: 轻量级应用设计
- **后台运行**: 不影响系统性能

### 稳定性

- **错误恢复**: 自动错误检测和恢复
- **资源管理**: 完善的资源清理机制
- **异常处理**: 全面的异常情况处理

## 总结

Moni 应用通过不断的功能扩展和技术改进，已经发展成为一个功能完整、性能优秀的网络监控工具。

从最初的简单监控到现在的全面服务监控，从基础功能到简化状态管理和状态指示，每一步的改进都致力于提供更好的用户体验和更强大的功能。

通过模块化设计、智能算法和用户友好的界面，Moni 不仅满足了基本的网络监控需求，还为高级用户提供了丰富的配置选项和扩展能力。

无论是开发者、运维工程师还是普通用户，都能在 Moni 中找到适合自己的功能和使用方式。
